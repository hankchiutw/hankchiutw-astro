import MainLayout from '../layouts/MainLayout.astro';
import { getAboutContent } from '../lib/strapi';
import type { StrapiAbout, StrapiSkill, StrapiExperience } from '../lib/strapi.types';

// Fetch about page content at build time
const aboutData = await getAboutContent();

// Fallback data based on CV text
const fallbackAbout: StrapiAbout = {
	id: 1,
	attributes: {
		title: "Professional Experience",
		introduction: "A dedicated software engineer specializing in web front-end development, with valuable experience in back-end technologies. Committed to delivering high-quality solutions that align with business goals and enhance user experiences.",
		skills: {
			data: [
				{ id: 1, attributes: { name: "TypeScript" } },
				{ id: 2, attributes: { name: "Angular" } },
				{ id: 3, attributes: { name: "RxJS" } },
				{ id: 4, attributes: { name: "Webpack" } },
				{ id: 5, attributes: { name: "React" } },
				{ id: 6, attributes: { name: "Node.js" } }
			] as StrapiSkill[]
		},
		experiences: {
			data: [
				{ 
					id: 1, 
					attributes: { 
						position: "Senior Front-end Engineer",
						company: "GoFreight",
						startDate: "2021-10-01",
						current: true,
						description: "First dedicated web front-end engineer to reshape the legacy codebase. Enabled the transition of traditional multi-page architecture to modern SPA. Designed and implemented an internal library to bootstrap AngularJS and Angular within the same codebase, enhancing developer productivity and code maintainability."
					} 
				},
				{ 
					id: 2, 
					attributes: { 
						position: "Senior Front-end Engineer",
						company: "aetherAI",
						startDate: "2019-07-01",
						endDate: "2021-10-01",
						description: "Collaborated with machine learning engineers to deliver new features for an image-viewing web application. Scaffolded an internal new project using Feature-Sliced Design methodology. Reduced Sentry logs from 10k to 1k events daily. Identified and addressed key performance bottlenecks, reducing page loading time from 4s to 2s."
					} 
				},
				{ 
					id: 3, 
					attributes: { 
						position: "Senior Front-end Engineer",
						company: "KaiOS Technology",
						startDate: "2017-01-01",
						endDate: "2019-06-01",
						description: "Developed mobile applications using web technologies on low-end mobile devices with restricted hardware resources. Migrated legacy System app to a modern toolchain (webpack, ES6, etc.). Refactored the legacy Contact app from vanilla JavaScript to React."
					} 
				}
			] as StrapiExperience[]
		},
		createdAt: new Date().toISOString(),
		updatedAt: new Date().toISOString()
	}
};

// Use Strapi data if available, otherwise use fallback
const about = aboutData || fallbackAbout;

<MainLayout title="Professional Experience">
	<h1>{about.attributes.title}</h1>
	<p class="introduction">{about.attributes.introduction}</p>
	
	<h2>Skills & Expertise</h2>
	<ul class="skills-list">
		{about.attributes.skills.data.map((skill: StrapiSkill) => (
			<li><span class="skill-tag">{skill.attributes.name}</span></li>
		))}
	</ul>
	
	<h2>Work History</h2>
	{about.attributes.experiences.data.map((exp: StrapiExperience) => (
		<div class="experience-item">
			<h3>{exp.attributes.position} at {exp.attributes.company}</h3>
			{exp.attributes.startDate && (
				<p class="experience-duration">
					{new Date(exp.attributes.startDate).toLocaleDateString('en-US', {year: 'numeric', month: 'long'})} - 
					{exp.attributes.current ? 'Present' : exp.attributes.endDate && new Date(exp.attributes.endDate).toLocaleDateString('en-US', {year: 'numeric', month: 'long'})}
				</p>
			)}
			<p>{exp.attributes.description}</p>
		</div>
	))}
</MainLayout>

<style>
	.introduction {
		font-size: 1.1rem;
		line-height: 1.6;
		max-width: 800px;
		margin-bottom: 2rem;
	}

	.skills-list {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
		list-style: none;
		padding: 0;
		margin-bottom: 2.5rem;
	}

	.skill-tag {
		background-color: var(--accent-bg);
		color: var(--primary-color);
		padding: 0.4rem 0.8rem;
		border-radius: 4px;
		font-size: 0.9rem;
		font-weight: 500;
	}

	.experience-item {
		margin-bottom: 2.5rem;
		padding-bottom: 2rem;
		border-bottom: 1px solid var(--border-color);
	}
	
	.experience-item:last-child {
		border-bottom: none;
	}
	
	.experience-duration {
		font-style: italic;
		color: var(--text-color-light);
		margin-top: -0.5rem;
		margin-bottom: 0.75rem;
	}
</style> 