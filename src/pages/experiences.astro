---
import MainLayout from '../layouts/MainLayout.astro';
import { getAboutContent } from '../lib/strapi';
import type { StrapiAbout, StrapiSkill, StrapiExperience } from '../lib/strapi.types';

// Fetch about page content at build time
const aboutData = await getAboutContent();

// Fallback data based on CV text
const fallbackAbout: StrapiAbout = {
	id: 1,
	attributes: {
		title: "Professional Experience",
		introduction: "A dedicated software engineer specializing in web front-end development, with valuable experience in back-end technologies. Committed to delivering high-quality solutions that align with business goals and enhance user experiences.",
		skills: {
			data: [
				{ id: 1, attributes: { name: "TypeScript" } },
				{ id: 2, attributes: { name: "Angular" } },
				{ id: 3, attributes: { name: "RxJS" } },
				{ id: 4, attributes: { name: "Webpack" } },
				{ id: 5, attributes: { name: "React" } },
				{ id: 6, attributes: { name: "Node.js" } }
			] as StrapiSkill[]
		},
		experiences: {
			data: [
				{ 
					id: 1, 
					attributes: { 
						position: "Senior Front-end Engineer",
						company: "GoFreight",
						startDate: "2021-10-01",
						current: true,
						description: "First dedicated web front-end engineer to reshape the legacy codebase. Enabled the transition of traditional multi-page architecture to modern SPA. Designed and implemented an internal library to bootstrap AngularJS and Angular within the same codebase, enhancing developer productivity and code maintainability."
					} 
				},
				{ 
					id: 2, 
					attributes: { 
						position: "Senior Front-end Engineer",
						company: "aetherAI",
						startDate: "2019-07-01",
						endDate: "2021-10-01",
						description: "Collaborated with machine learning engineers to deliver new features for an image-viewing web application. Scaffolded an internal new project using Feature-Sliced Design methodology. Reduced Sentry logs from 10k to 1k events daily. Identified and addressed key performance bottlenecks, reducing page loading time from 4s to 2s."
					} 
				},
				{ 
					id: 3, 
					attributes: { 
						position: "Senior Front-end Engineer",
						company: "KaiOS Technology",
						startDate: "2017-01-01",
						endDate: "2019-06-01",
						description: "Developed mobile applications using web technologies on low-end mobile devices with restricted hardware resources. Migrated legacy System app to a modern toolchain (webpack, ES6, etc.). Refactored the legacy Contact app from vanilla JavaScript to React."
					} 
				}
			] as StrapiExperience[]
		},
		createdAt: new Date().toISOString(),
		updatedAt: new Date().toISOString()
	}
};

// Use Strapi data if available, otherwise use fallback
const about = aboutData || fallbackAbout;
---

<MainLayout title="Professional Experience">
	<section class="experience-section">
		<h1>{about.attributes.title}</h1>
		<p class="introduction">{about.attributes.introduction}</p>
		
		<div class="section-container">
			<h2 class="section-title">Skills & Expertise</h2>
			<ul class="skills-list">
				{about.attributes.skills.data.map((skill: StrapiSkill) => (
					<li><span class="skill-tag"><i class="fas fa-check-circle"></i> {skill.attributes.name}</span></li>
				))}
			</ul>
		</div>
		
		<div class="section-container">
			<h2 class="section-title">Work History</h2>
			<div class="experience-timeline">
				{about.attributes.experiences.data.map((exp: StrapiExperience) => (
					<div class="experience-item">
						<div class="experience-header">
							<h3 class="company-title"><i class="fas fa-building"></i> {exp.attributes.position} at {exp.attributes.company}</h3>
							{exp.attributes.startDate && (
								<p class="experience-duration">
									<i class="far fa-calendar-alt"></i> {new Date(exp.attributes.startDate).toLocaleDateString('en-US', {year: 'numeric', month: 'long'})} - 
									{exp.attributes.current ? 'Present' : exp.attributes.endDate && new Date(exp.attributes.endDate).toLocaleDateString('en-US', {year: 'numeric', month: 'long'})}
								</p>
							)}
						</div>
						<p class="experience-description">{exp.attributes.description}</p>
					</div>
				))}
			</div>
		</div>
	</section>
</MainLayout>

<style>
	.experience-section {
		padding: 2rem 0;
	}

	.section-container {
		margin-bottom: 3rem;
	}

	.section-title {
		position: relative;
		padding-bottom: 0.5rem;
		margin-bottom: 1.5rem;
		font-size: 1.75rem;
		color: var(--primary-color);
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}

	.section-title::after {
		content: '';
		position: absolute;
		bottom: 0;
		left: 0;
		width: 60px;
		height: 3px;
		background-color: rgba(var(--primary-color-rgb), 0.6);
	}

	.introduction {
		font-size: 1.1rem;
		line-height: 1.6;
		max-width: 800px;
		margin-bottom: 2.5rem;
		color: var(--text-color-light);
	}

	.skills-list {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
		list-style: none;
		padding: 0;
	}

	.skill-tag {
		background-color: rgba(var(--primary-color-rgb), 0.1);
		color: var(--text-color);
		padding: 0.5rem 1rem;
		border-radius: var(--radius-sm);
		font-size: 0.9rem;
		font-weight: 500;
		transition: background-color 0.3s ease, transform 0.2s ease;
		display: flex;
		align-items: center;
		gap: 0.3rem;
	}

	.skill-tag i {
		color: var(--primary-color);
		font-size: 0.8rem;
	}

	.skill-tag:hover {
		background-color: var(--accent-hover);
		transform: translateY(-2px);
	}

	.experience-timeline {
		position: relative;
	}

	.experience-timeline::before {
		content: '';
		position: absolute;
		top: 0;
		bottom: 0;
		left: 0;
		width: 2px;
		background-color: var(--border-color);
	}

	.experience-item {
		position: relative;
		margin-bottom: 2.5rem;
		padding-bottom: 2rem;
		padding-left: 2rem;
		border-bottom: 1px solid var(--border-color);
	}
	
	.experience-item:last-child {
		border-bottom: none;
	}

	.experience-item::before {
		content: '\f0b1';
		font-family: 'Font Awesome 5 Free';
		font-weight: 900;
		position: absolute;
		top: 0.5rem;
		left: -10px;
		width: 20px;
		height: 20px;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 50%;
		background-color: rgba(var(--primary-color-rgb), 0.85);
		color: white;
		font-size: 0.7rem;
	}
	
	.experience-header {
		margin-bottom: 1rem;
	}

	.company-title {
		margin-top: 0;
		margin-bottom: 0.5rem;
		color: var(--text-color);
		font-size: 1.3rem;
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}
	
	.experience-duration {
		font-style: italic;
		color: var(--text-color-light);
		margin: 0;
		display: flex;
		align-items: center;
		gap: 0.3rem;
	}

	.experience-description {
		line-height: 1.6;
	}

	@media (max-width: 768px) {
		.experience-timeline::before {
			left: -1rem;
		}

		.experience-item {
			padding-left: 1rem;
		}

		.experience-item::before {
			left: -1.3rem;
		}
	}
</style> 